{% extends 'feedprofilebase.html' %}

{% block title %}Bunbook Home{% endblock %}

{% block content %}
Welcome {{ session["screenname"] }}
<br>
<div class="container">
  <!-- Create a Post form -->
  ----Create a Post----
  <form id="createpost" action="/create-post" method="post" enctype="multipart/form-data">
    <input type="text" placeholder="Create A Post!" name="post">
    <input type="file" name="my-file">
    <input type="submit">
  </form>
</div>
<br>

<div class="container">
<!-- The Timeline/Feed  -->
<!-- <br>
<button id="load-new-posts-button">Load New Posts</button> -->
<br>
--- The Timeline/Feed --- 
</div>
<br>
<div id="timeline">
  {% for post in posts %}
    <!-- <div class="container"> -->
      <div class="postblock">
        <!-- <img class="user-pic" src="{{ post.user.profilepic }}">
        <a href="/user/{{ post.user.user_id }}"> {{ post.user.screenname }}</a> -->

        <!-- view specific post -->
        <div class="viewpost">
          <img class="user-pic" src="{{ post.user.profilepic }}">
          <a href="/user/{{ post.user.user_id }}"> {{ post.user.screenname }}</a>

          <a href="/post/{{ post.post_id }}" class="viewpostge" title="View Post">
            <i class="fa-solid fa-up-right-from-square"></i>
          </a>
        </div>
        <br>
        body: {{ post.body }}
        <br>
        time: {{ post.timestamp }}
        <!-- Post_id: {{ post.post_id }} -->
        <br> 
        
        <!-- Show a post's images if any -->
          {% if post.images %}
          <img class="postimages" src="{{ post.images[0].image_link }}">
          {% endif %}
        
        <br>
        <!-- post.like will give a list, we want length of list -->
        Likes: {{ calculatelikes(post.like) }}
        <!-- Like a post form -->
        <form class="likeapost" action="/like-post" method="post">
          <input type="hidden" id="likepostid" name="likepostid" value="{{ post.post_id }}">
          <button type="submit" name="likebutton"><i class="fa-regular fa-heart"></i></button>
        </form>

        <!-- Create a Reply form -->
        <form class="createreply" action="/create-reply" method="post">
          <input type="hidden" id="postid" name="post_id" value="{{ post.post_id }}">
          <input type="text" placeholder="Reply!" name="reply">
          <button type="submit"><i class="fa-regular fa-comment-dots"></i></button>
        </form>

        <!-- Show replies button-->
        <button class="showreplies" data-postid="{{ post.post_id }}">Show Replies</button>

        <!-- Show replies to post if any -->
        <div class="replyblock" id="replyblock-{{ post.post_id }}" style="display:none">
          {% if post.reply %}
            {% for reply in post.reply %}
            <img class="user-pic" src="{{ reply.reply_user.profilepic }}">
            <a href="/user/{{ reply.reply_user.user_id }}">{{ reply.reply_user.screenname }}</a>
            <br>
            body: {{ reply.body }}
            <br>
            time: {{ reply.timestamp }}
            <!-- reply_id {{ reply.reply_id }} -->
            <br>
            Likes: {{ calculatelikes(reply.like) }}
            <br>
            <!-- Like a reply form -->
            <form class="likeareply" action="/like-reply" method="post" data-replyid="{{ reply.reply_id }}">
              <input type="hidden" id="likereplyid" name="likereplyid" value="{{ reply.reply_id}}">
              <button type="submit" name="likebutton"><i class="fa-regular fa-heart"></i></button>
            </form>
            {% endfor %}
          
          {% endif %}
        </div>

      </div>

  <!-- </div> -->
{% endfor %}

{% endblock %}